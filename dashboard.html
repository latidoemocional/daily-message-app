<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard ‚Äì Latido Emocional</title>

<style>
body{
  font-family: "Poppins", sans-serif;
  background: #fff0f6;
  margin: 0;
  padding: 20px;
  color:#5c2a3d;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}

.card{
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:20px;
}

h2{
  margin-top:0;
}

input, textarea, select, button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ddd;
  font-family:inherit;
}

button{
  background:#e91e63;
  color:white;
  border:none;
  cursor:pointer;
}

button:hover{
  opacity:.9;
}

.logout{
  background:#999;
}
</style>
</head>

<body>

<header>
  <h1>üíñ Mi Dashboard</h1>
  <button class="logout">Cerrar sesi√≥n</button>
</header>

<!-- MENSAJE DEL D√çA -->
<div class="card">
  <h2>üìÖ Mensaje por fecha</h2>

  <label>Fecha</label>
  <input type="date" id="fecha">

  <label>Estado (emoji)</label>
  <select id="emoji">
    <option value="">Sin estado</option>
    <option value="‚ù§Ô∏è">‚ù§Ô∏è Amor</option>
    <option value="üò¢">üò¢ Triste</option>
    <option value="‚≠ê">‚≠ê Especial</option>
  </select>

  <label>Mensaje</label>
  <textarea id="mensaje" rows="4"></textarea>

  <button>Guardar mensaje</button>
</div>

<!-- RESPUESTAS -->
<div class="card">
  <h2>üíå Respuestas recibidas</h2>
  <p>Pr√≥ximamente‚Ä¶</p>
</div>

<!-- CONFIGURACI√ìN -->
<div class="card">
  <h2>‚öôÔ∏è Configuraci√≥n</h2>

  <label>Link p√∫blico</label>
  <input type="text" readonly value="https://...">

  <button>Copiar link</button>
</div>



<script>
const API_URL = "https://script.google.com/macros/s/AKfycby689QTqrcRFD7C-tXUbIelrO11zP-eC5MSUjI3JKhqZFqZeo55Kbt9qS78386e0PajmQ/exec";

const params = new URLSearchParams(window.location.search);
const CLIENTE_ID = params.get("token");


const token = localStorage.getItem("latidos_token");
const clienteId = localStorage.getItem("latidos_cliente");

  
if(!token || !clienteId){
  alert("Acceso no autorizado");
  window.location.href = "login.html";
}

  
if (!CLIENTE_ID) {
  document.body.innerHTML = "<h2>Acceso no autorizado</h2>";
  throw new Error("Token faltante");
}






let mensajes = {};

function loadDashboard() {
  fetch(`${API_URL}?cliente=${CLIENTE_ID}&modo=dashboard`)
    .then(r => r.json())
    .then(data => {
      mensajes = data.mensajes || {};
      console.log("Mensajes cargados:", mensajes);
    });
}

loadDashboard();




document.querySelector("button").addEventListener("click", () => {
  const fecha = document.getElementById("fecha").value;
  const mensaje = document.getElementById("mensaje").value;
  const emoji = document.getElementById("emoji").value;

  if (!fecha || !mensaje) {
    alert("Completa fecha y mensaje");
    return;
  }

  const formData = new URLSearchParams();
  formData.append("tipo", "guardarMensaje");
  formData.append("cliente", CLIENTE_ID);
  formData.append("fecha", fecha);
  formData.append("mensaje", mensaje);
  formData.append("emoji", emoji);

  fetch(API_URL, {
  method: "POST",
  headers: {
    "Authorization": "Bearer " + token
  },
  body: JSON.stringify({
    action: "getDashboardData",
    clienteId: clienteId
  })
})
.then(r => r.json())
.then(res => {
  console.log(res);
});

  


  
</script>


</body>
</html>
