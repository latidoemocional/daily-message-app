<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Dashboard â€“ Latido Emocional</title>

<style>
body{
  font-family: "Poppins", sans-serif;
  background: #fff0f6;
  margin: 0;
  padding: 20px;
  color:#5c2a3d;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}

.card{
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:20px;
}

h2{
  margin-top:0;
}

input, textarea, select, button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ddd;
  font-family:inherit;
}

button{
  background:#e91e63;
  color:white;
  border:none;
  cursor:pointer;
}

button:hover{
  opacity:.9;
}

.logout{
  background:#999;
}
</style>
</head>

<body>

<header>
  <h1>ğŸ’– Mi Dashboard</h1>
  <button class="logout">Cerrar sesiÃ³n</button>
</header>

<!-- MENSAJE DEL DÃA -->
<div class="card">
  <h2>ğŸ“… Mensaje por fecha</h2>

  <label>Fecha</label>
  <input type="date" id="fecha">

  <label>Estado (emoji)</label>
  <select id="emoji">
    <option value="">Sin estado</option>
    <option value="â¤ï¸">â¤ï¸ Amor</option>
    <option value="ğŸ˜¢">ğŸ˜¢ Triste</option>
    <option value="â­">â­ Especial</option>
  </select>

  <label>Mensaje</label>
  <textarea id="mensaje" rows="4"></textarea>

  <button>Guardar mensaje</button>
</div>

<!-- RESPUESTAS -->
<div class="card">
  <h2>ğŸ’Œ Respuestas recibidas</h2>
  <p>PrÃ³ximamenteâ€¦</p>
</div>

<!-- CONFIGURACIÃ“N -->
<div class="card">
  <h2>âš™ï¸ ConfiguraciÃ³n</h2>

  <label>Link pÃºblico</label>
  <input type="text" readonly value="https://...">

  <button>Copiar link</button>
</div>



<script>
// ==============================
// CONFIG
// ==============================
const PLANTILLA_API_URL =
  "https://script.google.com/macros/s/AKfycbxtY9RJrtpEjVlmSimT4m66P4sTLtaEXwqKGv1x3zLArPtFsh6QdgIq3cqgK2kNwC_y/exec";

// ==============================
// SESIÃ“N 
// ==============================
const token = localStorage.getItem("latidos_token");
const clienteId = localStorage.getItem("latidos_cliente");

if (!token || !clienteId) {
  alert("Acceso no autorizado");
  window.location.href = "login.html";
}

// ==============================
// ESTADO
// ==============================
let mensajes = {};

// ==============================
// CARGAR MENSAJES (POST, NO GET)
// ==============================
function loadDashboard() {
  const formData = new URLSearchParams();
  formData.append("tipo", "dashboard");
  formData.append("cliente", clienteId);

  fetch(PLANTILLA_API_URL, {
    method: "POST",
    body: formData
  })
  .then(r => r.json())
  .then(data => {
    mensajes = data.mensajes || {};
    console.log("Mensajes cargados:", mensajes);
  })
  .catch(err => {
    console.error("Error cargando mensajes", err);
  });
}

loadDashboard();

// ==============================
// GUARDAR MENSAJE
// ==============================
document
  .querySelector(".card button")
  .addEventListener("click", () => {

    const fecha = document.getElementById("fecha").value;
    const mensaje = document.getElementById("mensaje").value;
    const emoji = document.getElementById("emoji").value;

    if (!fecha || !mensaje) {
      alert("Completa fecha y mensaje");
      return;
    }

    const formData = new URLSearchParams();
    formData.append("tipo", "guardarMensaje");
    formData.append("cliente", clienteId);
    formData.append("fecha", fecha);
    formData.append("mensaje", mensaje);
    formData.append("emoji", emoji);

    fetch(PLANTILLA_API_URL, {
      method: "POST",
      body: formData
    })
    .then(r => r.json())
    .then(res => {
      if (res.ok) {
        alert("Mensaje guardado â¤ï¸");
        loadDashboard();
      } else {
        alert("Error al guardar");
      }
    })
    .catch(err => {
      console.error("Error guardando mensaje", err);
    });
  });
</script>




</body>
</html>
